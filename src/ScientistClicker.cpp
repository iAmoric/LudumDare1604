
//Les includes nécessaires
#include "ResourceLoader.hpp"
#include "SplashScreen.hpp"
#include "LaboratoryRoom.hpp"
#include "HomePage.hpp"
#include <SFML/OpenGL.hpp>

static const struct {
    unsigned int width;
    unsigned int  	 height;
    unsigned int  	 bytes_per_pixel;
    unsigned char 	 pixel_data[32 * 32 * 4 + 1];
} gimp_image = {
        32, 32, 4,
        "\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\0\0\0\1$OO\7\0\0$\7$OO\7"
                "@\\b+#<B2\0\0\0\1\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\0\0\0\1$:D\34\27*3O\20#-\201\22\"-\244\15"
                "\34'\253\20!,\241\35""3;\231\33/:\215\25'/kO{{\7\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\37""6=(\22\"-|\20\40*\311\16\37(\365\15"
                "\35(\375\16\35(\376\16\35(\376\16\35(\376\15\34'\374\22!-\325\20\"*\341\22"
                "!,q\0\0\0\1\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0,DD\14\20!-j\17\40*\313\15\34'\375\16\35(\377"
                "\16\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\16\35"
                "(\377\17\37)\376\20!*\326\37""1;@\31""99\23\0DD\4\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0$:A*\17!*\231\15\35(\366\16\35(\377\16\37)\377\17"
                "\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377"
                "\17\37)\377\17\37)\377\15\34'\376\17!*\330\17!*\305\24'/\206!4;.\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\31.99\20\",\264\14\34'\376\16\37(\377\17\37)\377\17\37)\377"
                "\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37"
                ")\377\17\37)\377\17\37)\377\16\37)\377\16\35(\377\16\35(\375\20\",\336\40"
                """1;|$>G#\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
                "\0\34""494\20!*\271\15\34'\376\16\37)\377\17\37)\377\17\37)\377\17\37)\377"
                "\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37"
                ")\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\16\37)\377\14\34&\372\26"
                "(1\263Cbh1\0\0\0\1\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0""9QQ\30\17\40"
                "*\246\14\34'\376\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17"
                "\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377"
                "\17\37)\377\16\35(\377\16\37)\377\17\37)\377\17\37)\377\16\37)\377\15\35"
                "(\361\31-5j\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\0\0\0\1\23#.y\14\33&\373"
                "\16\37(\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37"
                ")\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\16"
                "\35(\3779>D\377\33'0\377\17\37)\377\17\37)\377\17\37)\377\16\35(\377\22\""
                ".\305-GO#\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0'=D(\17\40*\322\16\35(\377\17\37)\377\17"
                "\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377"
                "\17\37)\377\17\37)\377\17\37)\377\17\37)\377\16\35(\377FHM\377\312\262\252"
                "\377\177vv\377\15\34'\377\17\37)\377\17\37)\377\16\37(\377\15\34'\373\24"
                "'0r\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\31*4b\15\34'\372\16\37(\377\17\37)\377\17\37"
                ")\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17"
                "\37)\377\17\37)\377\16\37)\377\14\33&\377SSV\377\312\260\251\377\377\346"
                "\331\377\330\274\263\377-4<\377\17\37)\377\17\37)\377\17\37)\377\16\35(\377"
                "\20\",\2711DW\20\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\0^^\3\25&0\217\16\35(\376\17\37)\377\17\37)\377\17\37)\377"
                "\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\17\37)\377\16\37"
                ")\377\15\35(\377\32$/\377xpq\377\343\305\274\377\377\346\331\377\377\346"
                "\330\377\377\350\331\377\202xw\377\15\34'\377\17\37)\377\17\37)\377\16\35"
                "(\377\16\37)\345\37""9>0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0$$$\7\22#.\254\16\35(\377\17\37)\377\17\37)\377\17\37"
                ")\377\16\37)\377\16\35(\377\16\37)\377\15\34'\377\15\35(\377\16\34'\377\""
                ",5\377ebd\377\273\245\237\377\377\344\327\377\377\345\330\377\377\346\331"
                "\377\377\346\331\377\377\345\330\377\327\274\263\377*3:\377\17\37)\377\17"
                "\37)\377\17\37)\377\15\35'\362\34""1:F\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0(>V\15\22#.\274\16\35(\377\17\37)\377\17"
                "\37)\377\16\35(\377\25\",\377/9@\377\26!,\377ADI\377hcd\377\236\217\213\377"
                "\330\275\265\377\377\342\325\377\377\346\331\377\377\345\330\377\377\346"
                "\331\377\377\346\331\377\377\346\331\377\377\346\330\377\377\346\330\377"
                "|tt\377\15\34'\377\17\37)\377\17\37)\377\15\34(\370\32/6U\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\20(>\15\17\40*\275\16"
                "\35(\377\17\37)\377\16\37(\37707@\377\246\230\224\377\214\201|\377\236\217"
                "\212\377\333\304\273\377\371\330\314\377\377\346\331\377\377\345\330\377"
                "\377\345\330\377\377\346\330\377\377\344\327\377\377\345\330\377\377\346"
                "\331\377\377\346\331\377\377\350\331\377\377\346\331\377\320\266\257\377"
                "$-6\377\16\37)\377\17\37)\377\16\35(\373\37""7=b\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0(VV\15\22#-\272\16\35(\377\17"
                "\37)\377\22\37)\377\242\221\216\377\316\265\253\377\246\226\217\377\316\265"
                "\253\377\257\234\227\377\310\257\250\377\351\311\277\377\377\344\327\377"
                "\377\340\323\377\377\340\323\377\377\342\323\377\377\345\330\377\310\257"
                "\250\377\245\225\220\377\237\217\214\377\275\246\237\377\374\333\317\377"
                "rkm\377\15\34'\377\16\37)\377\16\35(\373!7@b\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\377\377\0,^^\6\23&/\243\16\35(\377\16\35"
                "(\377>BI\377\351\311\276\377\266\235\226\377\205tq\377^OQ\377PGK\377A=C\377"
                "~tr\377\374\326\311\377\377\337\322\377\377\342\325\377\377\340\323\377\343"
                "\302\267\377[OQ\377H<A\377]IK\377]FH\377\221rp\377\224xv\377)&.\377\31\35"
                "&\377\15\34(\370\32/:T\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\25'1w\15\34'\375\34\34$\377mGJ\377\212"
                "HF\377\222ZX\377\235nk\377\273\214\210\377\270\211\205\377\252{w\377\236"
                "nj\377\273\201{\377\342\262\251\377\353\274\262\377\310\221\212\377\246k"
                "g\377\253|x\377\303\230\225\377\321\251\244\377\326\254\250\377\274\221\217"
                "\377\242ki\377q67\377^:=\377\23\34'\357$7A?\365\334\334\14\353\353\257\5"
                "\377\377\377\0\377\377\377\0\374\346\321\16\377\340\327D\233\221\217{\24"
                "#.\354\37\37(\377xDG\377\250rp\377\377\342\333\377\377\376\367\377\377\370"
                "\360\377\377\360\346\377\377\361\350\377\371\334\326\377\233ba\377k\"#\377"
                "\17776\377g\35\37\377\304\227\222\377\377\360\345\377\377\360\345\377\377"
                "\365\353\377\377\374\365\377\377\377\376\377\377\352\344\377\225ZZ\377>$"
                "*\377,5=\337\336\305\274\222\377\345\327\262\377\343\327\223\376\343\325"
                ",\374\374\321\7\377\345\326\216\377\346\330\362\377\344\327\361pjk\376\15"
                "\35(\377^9<\377\322\245\241\377\377\372\362\377\377\367\355\377\377\363\353"
                "\377\334\312\302\377\363\342\333\377\377\377\374\377\300\222\217\377\236"
                "XT\377\325\222\205\377\214HF\377\357\314\305\377\377\372\363\377\340\320"
                "\310\377\334\312\303\377\377\372\363\377\377\377\371\377\377\377\374\377"
                "\235on\377919\377\265\241\233\374\377\344\327\374\377\334\317\376\377\345"
                "\327\376\377\344\327\213\370\342\322'\377\345\330\336\377\331\314\377\367"
                "\316\302\377\261\233\225\377\35&/\377x\\\\\377\317\243\235\377\377\372\362"
                "\377\377\370\360\377\377\376\367\377\363\333\321\377\377\354\344\377\377"
                "\377\375\377\265\204\202\377\314\214\202\377\375\275\253\377\262rk\377\323"
                "\251\243\377\377\375\366\377\374\336\323\377\372\335\323\377\377\377\371"
                "\377\377\377\371\377\377\377\370\377\221gg\377tgg\377\363\314\300\377\344"
                "\271\257\377\340\266\253\377\377\331\316\376\377\344\327\247\371\343\323"
                "(\377\346\330\340\365\313\277\377\333\257\245\377\326\254\242\377n^^\377"
                "\202nk\377\265\204\177\377\377\366\355\377\377\367\355\377\377\367\357\377"
                "\377\370\357\377\377\372\362\377\374\336\330\377\257vq\377\363\270\250\377"
                "\374\273\251\377\336\242\225\377\266\203~\377\377\363\353\377\377\366\354"
                "\377\377\367\355\377\377\370\357\377\377\371\361\377\361\321\312\377\216"
                "b`\377\234\207\202\377\325\252\241\377\323\250\236\377\336\262\250\377\377"
                "\330\313\376\377\344\327\204\357\334\311\20\377\344\327\272\365\313\277\377"
                "\334\260\246\377\320\244\231\377\313\245\234\377\343\304\270\377\271\205"
                "~\377\311\236\230\377\377\361\346\377\377\362\346\377\377\361\345\377\365"
                "\322\313\377\274\214\207\377\304\201u\377\375\274\252\377\374\274\252\377"
                "\376\275\253\377\274zo\377\305\230\222\377\365\320\306\377\377\350\334\377"
                "\377\352\337\377\355\312\302\377\267\207\202\377\252\204~\377\261\220\212"
                "\377\312\235\225\377\333\257\245\377\344\270\257\377\377\336\321\345\377"
                "\342\330A\377\377\377\0\377\345\327r\376\323\310\373\335\261\250\377\330"
                "\254\243\377\305\231\220\377\354\304\270\377\377\333\316\377\302\214\204"
                "\377\304\220\211\377\317\236\226\377\313\231\221\377\310\226\216\377\335"
                "\256\243\377\377\320\277\377\376\300\260\377\374\271\250\377\376\302\260"
                "\377\377\321\302\377\344\266\253\377\325\242\230\377\320\234\222\377\312"
                "\224\214\377\304\217\205\377\335\253\241\377\377\344\327\377\366\314\300"
                "\377\333\257\245\377\337\263\251\377\367\316\302\375\377\345\330\206\334"
                "\334\334\4\377\377\377\0\357\330\316\33\377\344\326\257\362\310\275\376\334"
                "\260\246\377\345\273\260\377\377\333\317\377\377\345\330\377\377\344\326"
                "\377\377\325\306\377\372\314\276\377\377\323\305\377\377\342\325\377\377"
                "\346\331\377\377\345\330\377\377\336\320\377\377\325\305\377\377\336\320"
                "\377\377\345\330\377\377\346\331\377\377\344\326\377\377\335\317\377\377"
                "\331\313\377\377\337\320\377\377\344\326\377\377\335\320\377\377\346\330"
                "\377\372\321\305\377\375\325\310\371\377\345\331\227\353\336\322\31\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\344\326?\377\343\326\276\375\325\310"
                "\376\377\333\316\377\377\351\333\377\365\322\310\377\377\346\330\377\377"
                "\345\330\377\377\345\330\377\377\345\330\377\377\343\326\377\377\327\313"
                "\377\377\322\305\377\376\314\277\377\376\313\277\377\375\312\276\377\377"
                "\316\302\377\377\323\306\377\377\343\326\377\377\345\330\377\377\345\330"
                "\377\377\345\330\377\377\337\322\377\222\205\202\376\273\245\237\351\377"
                "\345\331\257\377\344\326l\357\334\311\20\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\345\330.\377\343\326\211\377\342"
                "\325\273\227\212\210\360nhi\376\374\331\316\377\377\345\330\377\377\346\331"
                "\377\377\345\330\377\377\344\327\377\377\322\305\377\371\303\270\377\366"
                "\274\261\377\365\273\257\377\366\274\260\377\371\303\267\377\377\321\305"
                "\377\377\345\330\377\377\346\331\377\377\346\331\377\377\346\331\377\300"
                "\252\244\376!-5\340$4=\212\321\321\273\16\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\303\303\303\3\323\303\303\22\24$.\212\25#,\331\251\226\221\372\377"
                "\350\331\377\377\346\331\377\377\346\331\377\377\345\330\377\377\346\331"
                "\377\377\340\325\377\377\334\317\377\377\331\316\377\377\333\317\377\377"
                "\340\323\377\377\346\331\377\377\345\331\377\377\346\331\377\377\345\330"
                "\377\372\331\316\376omn\356\35""4<\225)@CE\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0)9A&)=DXunn\223\360\320\305"
                "\346\377\345\330\377\377\346\331\377\377\346\331\377\377\346\331\377\377"
                "\346\331\377\377\345\330\377\377\346\331\377\377\346\330\377\377\346\331"
                "\377\377\346\331\377\377\346\331\377\377\345\330\376\377\343\327\355\316"
                "\271\262\246-BJdStt\33O{\245\7\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0""6JJ\17\37DD\10\377"
                "\342\323S\377\346\330\303\377\345\330\375\377\345\330\377\377\346\331\377"
                "\377\346\331\377\377\346\331\377\377\346\331\377\377\346\331\377\377\346"
                "\331\377\377\345\330\377\377\345\330\371\377\344\327\261\377\345\327S^^^"
                "\11\0DD\4\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\343\323(\377\345\327|\377\342\326\315\377"
                "\345\327\373\377\346\331\377\377\346\331\377\377\346\331\377\377\346\331"
                "\377\377\346\331\376\377\343\326\333\377\345\325r\374\337\337\25\377\377"
                "\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377"
                "\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377"
                "\0\1\371\313\303!\377\333\317j\377\334\320\262\377\337\323\324\377\343\325"
                "\324\377\340\325\305\377\342\325\217\377\337\321?\377\377\377\0\377\377\377"
                "\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0"
                "\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0\377\377\377\0",
};

int main(int argc, char ** argv)
{
    // Checking args
    if(argc > 1) return FAILURE;
    std::cout << "\nRunning program : " << argv[0] << "\n" << std::endl;

    // Starting load of heavy resources
    // Launching thread
    ResourceLoader rLoader(DEBUG);
    rLoader.start();

    // Creating window
    sf::RenderWindow window(sf::VideoMode(WINDOW_WIDTH, WINDOW_HEIGHT),
    WINDOW_NAME, sf::Style::None);

    window.setIcon( gimp_image.width,  gimp_image.height,  gimp_image.pixel_data );

    // Window framerate - Default : 120 fps
    window.setFramerateLimit(WINDOW_FPS);

    // Starting some videos while loading res
    SplashScreen splash(DEBUG);
    splash.start(&window);

    // Getting loaded resources
    // Wait if not finished
    while(!rLoader.getLoadState()) sf::sleep(sf::milliseconds(WAIT_TIME));
    ManagerGroup * managerGroup = rLoader.getManager();

    // Creating menu
    LaboratoryRoom laboratoryRoom(DEBUG, managerGroup);
    HomePage homePage(DEBUG, managerGroup);
    //Les autres fenetres du jeu sont instanciées ici aussi

    // Setting main target
    //managerGroup->ptr_targetManager->isOnLaboratoryRoom();
    managerGroup->ptr_targetManager->isOnHomePage();
    //Boucle de jeu
    sf::Clock clock;
    while (window.isOpen())
    {
        // Exiting program
        if(!managerGroup->ptr_targetManager->isExit()) {
            managerGroup->ptr_musicManager->stopPlaylist();
            window.close();
            continue;
        }

        //Horloge de jeu
        double elapsedTime = clock.getElapsedTime().asSeconds();
        clock.restart().asMilliseconds();
        window.clear();

        //Boucle des évènements
        sf::Event event;
        while (window.pollEvent(event))
        {
            if (event.type == sf::Event::Closed)
                window.close();

        }

        // Updating game logic
        laboratoryRoom.update(&window, &event, elapsedTime);
        homePage.update(&window, &event, elapsedTime);
       //Les autres 'fenetres' sont actualisées à ce moment aussi
        managerGroup->ptr_musicManager->update();

        window.display();
    }

    return SUCCESS;
}